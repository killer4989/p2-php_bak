rep2 機能拡張パック 全部入り by 2ch774

●何？

rep2-expack https://github.com/rsky/p2-php
rep2-expack +live https://github.com/pluslive/p2-php
rep2-expack test https://github.com/orzisun/p2-php
上記やスレに上げられた修正を取り込んで全部入りを目指す闇鍋バージョンです。
独自の改良も行っています。

●動作環境
Linux(openSUSE Leap)のPHP7+Apacheで動作確認しています。
PHP5.6以降で動くはずですが、PHP7.*推奨です。
PHP7での不具合修正を優先するため突然PHP5.xのサポートが終わる可能性があります。

●主な機能
### 設定の追加
* 「ユーザー設定編集」から+liveリンクの表示設定を変更可能
* 実況板のスレ一覧からスレを開いたときに自動的に実況モードでスレを開く設定を追加
* 3ペイン表示の配置を変更できる設定を追加
* スレッドタイトルから著作権表記を削除する設定を追加
* スレッド作成日時の表示フォーマットを指定できるようにした
* まちBBSのホスト名を表示する設定を追加

### 新機能
* cronとかで最近読んだスレなどのdatをDL出来るスクリプト追加
  - scripts/fetch-dat.php --mode モードを一つ指定(fav recent res_hist)
* 名無しが節穴になる板に名無しで書き込むときに警告を出す機能を追加
* NGあぼーんの対象になったレスのIDを自動的にNGあぼーんする機能を追加
  - NGあぼーんの条件を削除した場合は自動NGあぼーんのデータ消去しないと反映されません
  - 自動NGあぼーんのデータは手動NGあぼーんと独立しており、自動NGあぼーんがONの時だけ読み込まれます。
* 「設定管理」からキャッシュ・履歴の消去できる機能を追加
* 本家からbeのログイン部分を移植してBE2.0に対応
* rep2に登録された外部板へリンクする機能を追加
* 0ちゃんねるスクリプトを使用した外部板の過去ログDATを取り込み対応
* SOCKS5プロクシ経由の接続に対応(人柱)
* tor内の掲示板(.onionドメイン)をtor経由で閲覧する機能を追加(人柱)

### 仕様変更
* ローカル板一覧用.brdファイルの置き場所をrep2/boardから$_conf['data_dir']/brardに変更
  - .brdはopenJaneと同じ形式です。
* スマホ用画面のツールバーアイコンを高解像度画面に対応(thx https://github.com/dgg712/p2-php)
* スマホ用レスポップアップ、SPM、IC2の外側をタップすると閉じるように変更
  - レスポップアップから開いたレスポップアップをタップした際に元のレスポップアップが消えるのは仕様とさせていただきます。
  - スクロールは指の終着点がポップアップ内になるようにすれば消えません。
* headline.2ch.netを最近読んだスレに追記しないように変更
* Youtubeとニコニコ動画を表示する機能を削除
  - リンクプラグインを使用してください http://akid.s17.xrea.com/p2puki/index.phtml?%A5%EA%A5%F3%A5%AF%A5%D7%A5%E9%A5%B0%A5%A4%A5%F3

その他今時のアレに合わせた修正等gitのコミットログも確認してください。


●免責

 本ソフトウェアの使用により直接および間接的に生じたいかなる損害も補償いたしません。
 使用は自己責任で。


●注意

 設置者本人が悪用するのはもちろん、認証を切るなどして
 第三者に悪用されても仕方ない環境で使うのはやめてください。


●ライセンス

 本家p2と同じく、X11ライセンスです。


●ChangeLog
170921.1800
* vip2ch.com読み込み対応
* 2chのUnicode絵文字投稿に対応
* PHP7.1でしたら場が読めない不具合を修正
* Torが動かない不具合修正
* 2chでAPI 未使用でも見れる板に対応
* まちBBS にてドメインでもスレを見れるようにした
* SS 速報 R の移転検知できるようにした
* (人柱機能)curl を用いた並列ダウンロード機能を追加
* スマホ用書き込み欄のデザインを変更

160410.0125
* NGスレッド機能が本体と+Wikiで重複して実装されているので削除
* 160409.1000 に新着纏め読みと実況等が動作しない不具合があるので修正
* 実況リンクに&lsを付加しないように変更
* ユーザー設定管理に+Wikiのsambaタイマーに関する設定項目を表示するように変更

160409.1000
* NGスレッド機能が動作しない不具合を修正
* 画像置換URLが動作しない不具合修正
* びんたんのURL判定を更新
* composer.json内のURLを更新して新規インストール時の不具合修正

160309.0710
* 以下の変更点はkiller4989さんのパッチを取り込み
* SOCKS5接続とtor接続が機能していない不具合を修正
* スマホ版したらばのURLを開けるように変更

160304.1333
* 不足していた高解像度アイコンを追加 thx! http://potato.2ch.net/test/read.cgi/software/1431258367/767
* ●でDATをダウンロードする為のコードとリンクを除去
* DAT落ちの判定に2ch APIの独自レスポンスヘッダを使用するように変更
* API+浪人で取得したDATを過去ログ扱いするように変更
* SOCKS5プロクシ経由の接続に対応(人柱)
* tor内の掲示板(.onionドメイン)をtor経由で閲覧する機能を追加(人柱)
* 以下の変更点はkiller4989さんのパッチを取り込み
* vip2ch.com 対応
* びんたん･べっかんこの URL が指定された時に正しくスレが表示されるようにした
* ｢浪人お役立ちツール｣のリンクを追加
* スレッド作成日時の表示フォーマットを指定できるようにした
* その他諸々

150815.1030
* 表示レス数の上限を2000から65535に変更
* まちBBSのホスト名を表示する設定を追加（killer4989さんのパッチを取り込み）

150711.1000
* バージョン番号の数字ミスってたので 151710.1400 を欠番にして付け直し
* 更新内容に問題無いはずなので内容は 151710.1400 と同一です。

151710.1400
* キャッシュ確認で30分おきに更新するはずが30時間になっていたので修正
* DAT の2行目が過去ログであることを示しているようであれば過去ログ扱いにする
* 公式 P2 関連のコードを削除
* offlaw2(shiro=kuma)を削除
* 上記の変更点はkiller4989さんのパッチを取り込み
* 設定項目2chapi_rouninを削除（強制ONに変更）

150510.1111
* Youtubeとニコ動の内蔵リンクプラグインを削除
* Youtube関連の設定を全て削除
* showボタンをリンクプラグインから利用出来るように変更
* スマホ向けreadにPCのリンクプラグインが反映されるようにした
* 画像置換URLのEXTRACTの重複URLを無視するように変更
* サービス終了に伴って使用できなくなった機能の設定を一部削除

150426.1033
* ガラケー向けreadのsyntax error修正
* 302が発生するURLでRSSリーダ正常動作しない不具合を修正
* RSSリーダからHTTP_Request2に存在しない関数を呼び出していた部分を削除
* P2Util::fileDownloadでIf-Modified-Sinceを送信しない不具合を修正
* キャッシュ削除に板一覧の削除機能追加
* 左上戻るボタンを高解像度対応に変更

150418.1111
* スマホ用画面のツールバーアイコンを高解像度画面に対応(thx https://github.com/dgg712/p2-php)
* rep2に登録された外部板へリンクする機能を追加
* 0ちゃんねるスクリプトを使用した外部板の過去ログDATを取り込み対応
* headline.2ch.netを最近読んだスレに追記しないように変更
* Firefoxでスマホ用表示が崩れる不具合を修正
* スマホ用IC2のポップアップで既に設定済みの星をタップした際にエラーを出さないように変更
* スマホ用IC2のポップアップに表示されるURLをリンクに変更(thx http://anago.2ch.net/test/read.cgi/software/1426940268/711)
* スマホ用IC2で画像表示をダブルタップすると閉じるように変更(txh http://anago.2ch.net/test/read.cgi/software/1426940268/711)
* スマホ用レスポップアップ、SPM、IC2の外側をタップすると閉じるように変更

150414.2333
* スマホ用readに書き込みフォームを追加
* スマホ用画面のデザインを変更
* DAT取得プラグインが動作しない不具合を修正
* その他諸々

150408.1234
* NGあぼーんの対象になったレスのIDを自動的にNGあぼーんする機能を追加
* HTTP通信のヘッダを見直し
* dig2ch.phpで解析エラーが発生した際に詳細情報を出すように変更

150406.2211
* 節穴板と名無しで書き込みできない板の条件を正しく動作するように修正
* 名無しで書込出来ない板は書き込み続行できないように変更
* expackのsageチェック機能と本文が空チェック機能のデフォルト値をONに変更

150406.1111
* 名無しが節穴になる板に名無しで書き込むときに警告を出す機能を追加
* 設定管理にCookieやその他の履歴を削除出来る機能を追加
* http://page2.skr.jp/rep2/ が消滅してしまったのでgate.phpの代替を追加
* HTTP接続ではSSL関係の設定を無視するように変更
* 2ch.netとのSSL通信を設定で選べるように変更
* 書き込みで例外が発生した際にエラーメッセージが表示されない不具合を修正
* その他諸々

150402.1350
* 接続先が2ch.netならばSSL通信を行うように変更(pinkとbeログイン認証は対応していないのでしない)
* ssl_functionのデフォルト設定をcURLに変更
* SSL通信以外でもSSLの設定が反映されるように変更
* 上記変更のためcURL必須に変更

150401.2321
* 認証付プロキシに対応（BASIC認証のみ）
* SSL通信のopenSSLとcURLを切り替えることが出来る設定を追加
* dig.2ch.netに送るヘッダを変更
* 2chとの通信をHTTP_Request2に変更

150328.2132
* dig2chの鯖に軽微な不具合が発生したときの対策を講じた
* dig2chで検索結果の番号が1から表示されるように修正
* dig2chのjsonエラー処理を変更
* dig2chがプロキシ設定(proxy_use)に対応していない不具合を修正
* dig2chで「板で絞り込む」に対応した
* 置換ワードをポップアップにも効くように変更
* レスをポップアップ(quote_res_view)が無効なときに実況モードのID色づけ(coloredid)が効かない不具合を修正

150320.1020
* ポップアップから書き込み成功した後にスレを再読み込みしない設定を追加
* 実況モードからの書き込みでCookie確認が発生した場合実況モードに戻れない不具合を修正
* メンテナンス性を向上させるためlive_ShowThreadPc.phpとlive_ShowThread.phpの代わりに
* live_ShowThreadLive.phpと本体のShowThread.phpを使用するように変更
* 下書き保存(expack.editor.savedraft)が無効なときに実況モードから書き込めない不具合を修正
* スレタイ検索でWarningが出る不具合を修正

150317.1200
* その他諸々

150316.1120
* 3ペイン表示の配置を変更できる設定を追加
* Beのアイコンを表示できるようにした
* その他諸々

150315.0117
* youtu.beとnico.(ms|sc)のプレビューに対応
* YouTubeの埋め込み方法をobjectからiframeに変更
* cronとかで最近読んだスレなどのdatをDL出来るスクリプト追加
* 一部の画面デザインを本家っぽいデザインに変更
* 一部のレスの改行が削除される不具合を修正
* IDを色づけしない設定の際にIDの表示がおかしくなる不具合を修正
* 2chのDAT提供終了に伴うログ破損対策を追加
* 本家からbeのログイン部分を移植してBE2.0に対応
* 既取得スレでもスレ一覧に元スレのリンクを表示できる設定を追加
* その他諸々

150307.1230
* docディレクトリに各機能のReadme.txtを作成
* 「ユーザー設定編集」から+liveリンクの表示設定を変更可能
* 実況板のスレ一覧からスレを開いたときに自動的に実況モードでスレを開く設定を追加
* スレッドタイトルから著作権表記を削除する設定を追加
* ローカル板一覧用.brdファイルの置き場所をrep2/boardから$_conf['data_dir']/brardに変更
* その他諸々